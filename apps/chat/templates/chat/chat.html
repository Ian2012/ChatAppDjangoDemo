{% extends 'base.html' %}
{% block title %}
	Login |
{% endblock %}
{% block content %}
	<h1>Welcome!</h1>
	<hr>
	<div id="chatapp">
		<h2>Chat</h2>
		<div class="container">
			<h3>Lastest messages</h3>
			<div class="message" v-for="message in messages">
				<p v-if="message.username == username">Me at [[message.timestamp]]</p>
				<p v-else="">[[message.username]] at [[message.timestamp]]</p>
				<img :src="message.image" alt="Image here >.<" height="64">
				<hr>
			</div>
			<!--TODO Enviar la imagen y crear la lógica para añadir un mensaje
			<input type="file" name="image" id="image" accept="image/*">
			<button type="submit" @click="submit"> Submit</button>-->
		</div>
	</div>

	<hr>
	<h2>Users </h2>
	{% for user in users %}
		{{ user.username }} | {{ user.last_login }}
	{% endfor %}
{% endblock %}

{% block scripts %}
	<script>
        let chatapp = new Vue({
            el: '#chatapp',
            delimiters: ['[[', ']]'],
            data() {
                return {
                    messages: {},
                    username: '{{ request.user.username }}',
                }
            },
            mounted() {
                this.loadMessages()
            },
            methods: {
                loadMessages() {
                    let self = this;
                    axios.get('{% url 'chat_api:list-create-message' %}')
                        .then(function (response) {
                            self.messages = response.data
                            console.log(self.messages)
                            self.messages.forEach(function (value, index) {
                                console.log("En el índice " + index + " hay este valor: " + value);
                                self.messages[index].timestamp = new Date(self.messages[index].timestamp).toLocaleString()
                            });
                        })
                },
                deleteMessage(id) {
                    console.log("Delete message:", id)
                },
            }
        });

	</script>
{% endblock %}